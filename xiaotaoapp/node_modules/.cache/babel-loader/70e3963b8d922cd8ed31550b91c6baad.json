{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports['default'] = undefined;\n\nvar _class, _temp, _initialiseProps;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _nextDropdown = require('../../next-dropdown/lib/index.js');\n\nvar _nextDropdown2 = _interopRequireDefault(_nextDropdown);\n\nvar _nextMenu = require('../../next-menu/lib/index.js');\n\nvar _nextMenu2 = _interopRequireDefault(_nextMenu);\n\nvar _nextButton = require('../../next-button/lib/index.js');\n\nvar _nextButton2 = _interopRequireDefault(_nextButton);\n\nvar _nextIcon = require('../../next-icon/lib/index.js');\n\nvar _nextIcon2 = _interopRequireDefault(_nextIcon);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);\n} // 共享状态的组件需要变成非受控组件\n\n\nvar Filter = (_temp = _class = function (_React$Component) {\n  _inherits(Filter, _React$Component);\n\n  function Filter(props) {\n    _classCallCheck(this, Filter);\n\n    var _this = _possibleConstructorReturn(this, _React$Component.call(this, props));\n\n    _initialiseProps.call(_this);\n\n    var filterParams = props.filterParams || {};\n    var filterConfig = filterParams[props.dataIndex] || {};\n    _this.state = {\n      visible: filterConfig.visible || false,\n      selectedKeys: filterConfig.selectedKeys || []\n    };\n    _this._selectedKeys = [].concat(_toConsumableArray(_this.state.selectedKeys));\n    return _this;\n  }\n\n  Filter.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if (nextProps.hasOwnProperty('filterParams') && typeof nextProps.filterParams !== 'undefined') {\n      var dataIndex = nextProps.dataIndex || this.props.dataIndex;\n      var filterParams = nextProps.filterParams || {};\n      var filterConfig = filterParams[dataIndex] || {};\n      var selectedKeys = filterConfig.selectedKeys || [];\n      this.setState({\n        selectedKeys: selectedKeys\n      });\n      this._selectedKeys = [].concat(_toConsumableArray(selectedKeys));\n    }\n  };\n\n  Filter.prototype.render = function render() {\n    var _props = this.props,\n        filters = _props.filters,\n        prefix = _props.prefix,\n        locale = _props.locale,\n        filterMode = _props.filterMode;\n    var _state = this.state,\n        visible = _state.visible,\n        selectedKeys = _state.selectedKeys;\n\n    var renderMenuItem = function renderMenuItem(item) {\n      return _react2['default'].createElement(_nextMenu2['default'].Item, {\n        key: item.value\n      }, item.label);\n    },\n        renderMenuContent = function renderMenuContent(list) {\n      return list.map(function (item) {\n        return renderMenuItem(item);\n      });\n    },\n        content = filters.map(function (filter, index) {\n      if (filter.children) {\n        return _react2['default'].createElement(_nextMenu2['default'].SubMenu, {\n          label: filter.label,\n          key: 'popup' + index,\n          selectable: false\n        }, renderMenuContent(filter.children));\n      } else {\n        return renderMenuItem(filter);\n      }\n    }),\n        footer = _react2['default'].createElement('div', {\n      className: prefix + 'table-filter-footer'\n    }, _react2['default'].createElement(_nextButton2['default'], {\n      type: 'primary',\n      onClick: this.onFilterConfirm\n    }, locale.ok), _react2['default'].createElement(_nextButton2['default'], {\n      onClick: this.onFilterClear\n    }, locale.reset));\n\n    return _react2['default'].createElement(_nextDropdown2['default'], {\n      trigger: _react2['default'].createElement('span', {\n        className: prefix + 'table-filter'\n      }, _react2['default'].createElement(_nextIcon2['default'], {\n        type: 'filter',\n        size: 'small'\n      })),\n      triggerType: 'click',\n      visible: visible,\n      onVisibleChange: this.onFilterVisible\n    }, _react2['default'].createElement(_nextMenu2['default'], {\n      footer: footer,\n      selectedKeys: selectedKeys,\n      selectMode: filterMode,\n      onSelect: this.onFilterSelect\n    }, content));\n  };\n\n  return Filter;\n}(_react2['default'].Component), _class.propTypes = {\n  dataIndex: _propTypes2['default'].string,\n  filters: _propTypes2['default'].array,\n  filterMode: _propTypes2['default'].string,\n  filterParams: _propTypes2['default'].object,\n  locale: _propTypes2['default'].object,\n  onFilter: _propTypes2['default'].func,\n  prefix: _propTypes2['default'].string\n}, _class.defaultProps = {\n  onFilter: function onFilter() {}\n}, _initialiseProps = function _initialiseProps() {\n  var _this2 = this;\n\n  this.onFilterVisible = function (visible, reason) {\n    if (!reason) {\n      _this2.setState({\n        visible: visible\n      });\n\n      if (!visible) {\n        var selectedKeys = [].concat(_toConsumableArray(_this2._selectedKeys));\n\n        _this2.setState({\n          selectedKeys: selectedKeys\n        });\n      }\n    }\n  };\n\n  this.onFilterSelect = function (selectedKeys) {\n    _this2.setState({\n      visible: true,\n      selectedKeys: selectedKeys\n    });\n  };\n\n  this.onFilterConfirm = function () {\n    var selectedKeys = _this2.state.selectedKeys;\n    var filterParams = {},\n        dataIndex = _this2.props.dataIndex;\n    filterParams[dataIndex] = {\n      visible: false,\n      selectedKeys: selectedKeys\n    };\n    _this2._selectedKeys = [].concat(_toConsumableArray(selectedKeys));\n\n    _this2.setState({\n      visible: false\n    }); // 兼容之前的格式\n\n\n    _this2.props.onFilter(filterParams);\n  };\n\n  this.onFilterClear = function () {\n    var filterParams = {},\n        dataIndex = _this2.props.dataIndex;\n    filterParams[dataIndex] = {\n      visible: false,\n      selectedKeys: []\n    };\n    _this2._selectedKeys = [];\n\n    _this2.setState({\n      selectedKeys: [],\n      visible: false\n    }); // 兼容之前的格式\n\n\n    _this2.props.onFilter(filterParams);\n  };\n}, _temp);\nFilter.displayName = 'Filter';\nexports['default'] = Filter;\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}