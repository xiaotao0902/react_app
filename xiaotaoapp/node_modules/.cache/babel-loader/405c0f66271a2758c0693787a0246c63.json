{"ast":null,"code":"'use strict';\n\nfunction hidden(node) {\n  return node.style.display == 'none';\n}\n\nfunction visible(node) {\n  while (node) {\n    if (node === document.body) {\n      break;\n    }\n\n    if (hidden(node)) {\n      return false;\n    }\n\n    node = node.parentNode;\n  }\n\n  return true;\n}\n\nfunction focusable(node) {\n  var nodeName = node.nodeName.toLowerCase(),\n      tabIndex = parseInt(node.getAttribute('tabindex'), 10),\n      hasTabIndex = !isNaN(tabIndex) && tabIndex > -1;\n\n  if (visible(node)) {\n    if (['input', 'select', 'textarea', 'button'].indexOf(nodeName) > -1) {\n      return !node.disabled;\n    } else if (nodeName == 'a') {\n      return node.getAttribute('href') || hasTabIndex;\n    } else {\n      return hasTabIndex;\n    }\n  }\n}\n\nfunction getFocusNodeList(node) {\n  var res = [],\n      nodeList = node.querySelectorAll('*'),\n      length = nodeList.length;\n\n  for (var i = 0; i < length; i++) {\n    var item = nodeList[i];\n\n    if (focusable(item)) {\n      var method = item.getAttribute('data-auto-focus') ? 'unshift' : 'push';\n      res[method](item);\n    }\n  }\n\n  if (focusable(node)) {\n    res.unshift(node);\n  }\n\n  return res;\n}\n\nvar lastFocusElement = null;\n\nfunction saveLastFocusNode() {\n  lastFocusElement = document.activeElement;\n}\n\nfunction clearLastFocusNode() {\n  lastFocusElement = null;\n}\n\nfunction backLastFocusNode() {\n  if (lastFocusElement) {\n    try {\n      // 元素可能已经被移动了\n      lastFocusElement.focus();\n    } catch (e) {}\n  }\n}\n\nfunction limitTabRange(node, e) {\n  if (e.keyCode == 9) {\n    var tabNodeList = getFocusNodeList(node),\n        lastTabNode = tabNodeList[e.shiftKey ? 0 : tabNodeList.length - 1],\n        leavingTab = lastTabNode === document.activeElement || node === document.activeElement;\n\n    if (leavingTab) {\n      var target = tabNodeList[e.shiftKey ? tabNodeList.length - 1 : 0];\n      target.focus();\n      e.preventDefault();\n    }\n  }\n}\n\nexports.saveLastFocusNode = saveLastFocusNode;\nexports.clearLastFocusNode = clearLastFocusNode;\nexports.backLastFocusNode = backLastFocusNode;\nexports.getFocusNodeList = getFocusNodeList;\nexports.limitTabRange = limitTabRange;","map":null,"metadata":{},"sourceType":"script"}