{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports['default'] = undefined;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _class, _temp;\n/* eslint-disable react/prop-types */\n\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _classnames2 = require('classnames');\n\nvar _classnames3 = _interopRequireDefault(_classnames2);\n\nvar _nextUtil = require('../../next-util/lib/index.js');\n\nvar _nextDom = require('../../next-dom/lib/index.js');\n\nvar _nextIcon = require('../../next-icon/lib/index.js');\n\nvar _nextIcon2 = _interopRequireDefault(_nextIcon);\n\nvar _nextAnimate = require('../../next-animate/lib/index.js');\n\nvar _nextAnimate2 = _interopRequireDefault(_nextAnimate);\n\nvar _container = require('./container.js');\n\nvar _container2 = _interopRequireDefault(_container);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);\n}\n\nvar Component = _container2['default'];\n/**\n * Menu.SubMenu\n * @order 2\n **/\n\nvar SubMenu = (_temp = _class = function (_Component) {\n  _inherits(SubMenu, _Component);\n\n  SubMenu.prototype.getChildContext = function getChildContext() {\n    var parentIndex = normalizeInfo(this.context, 'parentIndex', this.props.index),\n        parentLabel = normalizeInfo(this.context, 'parentLabel', this.props.label || this.props.children);\n    return {\n      parentIndex: parentIndex,\n      parentLabel: parentLabel\n    };\n  };\n\n  function SubMenu(props) {\n    _classCallCheck(this, SubMenu);\n\n    var _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n    ['onDocumentClick', 'onSubMenuClick', 'onSubMenuMouseEnter', 'onSubMenuMouseLeave', 'onContentMouseEnter', 'onContentMouseLeave', 'onKeyDown'].forEach(function (method) {\n      _this[method] = _this[method].bind(_this);\n    });\n\n    var root = _this.getRoot();\n\n    if (!root) {\n      throw new Error('SubMenu should use under Menu.');\n    }\n\n    _this.root = root;\n    _this.Menu = root.constructor;\n    _this.MenuItem = root.constructor.Item;\n    return _this;\n  }\n\n  SubMenu.prototype.normalizeVisible = function normalizeVisible() {\n    return 'visible' in this.props ? this.props.visible : this.props.openKeys.indexOf(this.props.index) > -1;\n  };\n\n  SubMenu.prototype.render = function render() {\n    var _classnames,\n        _this2 = this;\n\n    var _props = this.props,\n        className = _props.className,\n        label = _props.label,\n        animation = _props.animation,\n        disabled = _props.disabled,\n        children = _props.children,\n        indentSize = _props.indentSize,\n        mode = _props.mode,\n        triggerType = _props.triggerType,\n        selectable = _props.selectable,\n        align = _props.align,\n        index = _props.index,\n        hasSelectedIcon = _props.hasSelectedIcon,\n        selected = _props.selected,\n        others = _objectWithoutProperties(_props, ['className', 'label', 'animation', 'disabled', 'children', 'indentSize', 'mode', 'triggerType', 'selectable', 'align', 'index', 'hasSelectedIcon', 'selected']),\n        prefix = this.getPrefix(),\n        visible = this.normalizeVisible(),\n        cls = (0, _classnames3['default'])((_classnames = {}, _defineProperty(_classnames, prefix + 'menu-submenu-item', mode === 'inline'), _defineProperty(_classnames, prefix + 'menu-submenu-item-popup', mode === 'popup'), _defineProperty(_classnames, 'opened', visible), _defineProperty(_classnames, align, align), _defineProperty(_classnames, 'disabled', disabled), _defineProperty(_classnames, className, className), _classnames)),\n        Menu = this.Menu,\n        MenuItem = this.MenuItem,\n        child = _react2['default'].createElement(Menu, null),\n        icon = void 0,\n        events = void 0,\n        contentEvents = void 0;\n\n    if (mode === 'inline') {\n      icon = _react2['default'].createElement(_nextIcon2['default'], {\n        type: 'arrow-down',\n        className: visible ? 'opened' : '',\n        size: 'xs'\n      });\n    } else {\n      icon = _react2['default'].createElement(_nextIcon2['default'], {\n        type: 'arrow-right',\n        size: 'xs'\n      });\n    }\n\n    if (triggerType === 'click') {\n      events = {\n        onClick: function onClick(e) {\n          _this2.onSubMenuClick(e);\n\n          _this2.props.onClick(e);\n        }\n      };\n    } else {\n      events = {\n        onMouseEnter: this.onSubMenuMouseEnter,\n        onMouseLeave: this.onSubMenuMouseLeave,\n        onClick: function onClick(e) {\n          e && e.stopPropagation();\n\n          if (selectable) {\n            _this2.root.onItemClick(e, index, 'click', _this2);\n          }\n\n          _this2.props.onClick(e);\n        }\n      };\n      contentEvents = {\n        onMouseEnter: this.onContentMouseEnter,\n        onMouseLeave: this.onContentMouseLeave\n      };\n    }\n\n    child = _react2['default'].cloneElement(child, _extends({\n      mode: mode\n    }, others, contentEvents, {\n      indentSize: mode === 'inline' ? indentSize + child.props.indentSize : indentSize,\n      ref: 'content',\n      children: children,\n      hasSubMenu: true,\n      parent: this\n    }));\n\n    if (animation) {\n      var oneTransitionEnd = function oneTransitionEnd(node, done) {\n        var timeout = void 0;\n\n        var handler = function handler() {\n          [animation['in'], animation['in'] + '-active', animation.out, animation.out + '-active'].forEach(function (className) {\n            _nextDom.classList.removeClass(node, className);\n          });\n\n          _nextDom.style.set(node, 'height', null);\n\n          clearTimeout(timeout);\n          done();\n        };\n\n        timeout = setTimeout(handler, 250);\n      };\n\n      var enterHook = function enterHook(node, done) {\n        _nextDom.classList.addClass(node, 'out-screen');\n\n        _nextDom.classList.removeClass(node, 'hide');\n\n        var height = node.offsetHeight + 'px';\n\n        _nextDom.classList.addClass(node, animation['in']);\n\n        _nextDom.classList.removeClass(node, 'out-screen');\n\n        setTimeout(function () {\n          _nextDom.classList.addClass(node, animation['in'] + '-active');\n\n          _nextDom.style.set(node, 'height', height);\n        }, 1);\n        oneTransitionEnd(node, done);\n      };\n\n      var leaveHook = function leaveHook(node, done) {\n        var height = node.offsetHeight + 'px';\n\n        _nextDom.style.set(node, 'height', height);\n\n        _nextDom.classList.addClass(node, animation.out);\n\n        setTimeout(function () {\n          _nextDom.classList.addClass(node, animation.out + '-active');\n\n          _nextDom.style.set(node, 'height', 0);\n        }, 1);\n        oneTransitionEnd(node, done);\n      };\n\n      var animationConfig = void 0;\n\n      if (mode === 'inline') {\n        animationConfig = {\n          enter: enterHook,\n          leave: leaveHook,\n          appear: enterHook\n        };\n      } else {\n        animationConfig = {\n          enter: animation['in'],\n          leave: animation.out,\n          appear: animation['in']\n        };\n      }\n\n      if (mode === 'popup') {\n        child = _react2['default'].createElement('div', {\n          className: prefix + 'menu-wrapper'\n        }, child);\n      }\n\n      child = _react2['default'].createElement(_nextAnimate2['default'], {\n        animationAppear: false,\n        animation: animationConfig,\n        useTransition: true\n      }, visible ? child : null);\n    } else {\n      child = _react2['default'].cloneElement(child, {\n        style: {\n          display: visible ? '' : 'none'\n        }\n      });\n    }\n\n    if (selectable && triggerType === 'click') {\n      icon = _react2['default'].cloneElement(icon, events);\n      return (// 设置needIndent为false\n        // 使用subMenu的title来控制\n        _react2['default'].createElement(MenuItem, _extends({}, others, {\n          index: index,\n          hasSelectedIcon: hasSelectedIcon,\n          selected: selected,\n          className: cls,\n          'aria-haspopup': true,\n          parent: this,\n          onKeyDown: this.onKeyDown,\n          indentSize: indentSize,\n          needIndent: false,\n          label: label\n        }), _react2['default'].createElement('div', {\n          className: prefix + 'menu-submenu-title',\n          style: {\n            paddingLeft: indentSize\n          }\n        }, label, icon), child)\n      );\n    } else {\n      if (typeof selected === 'undefined') {\n        selected = this.root.state.selectedKeys.indexOf(index) > -1;\n      }\n\n      var selectedIcon = hasSelectedIcon && selectable ? _react2['default'].createElement(_nextAnimate2['default'], {\n        animation: {\n          appear: 'zoomIn',\n          enter: 'zoomIn',\n          leave: 'zoomOut'\n        }\n      }, selected ? _react2['default'].createElement(_nextIcon2['default'], {\n        type: 'select',\n        className: prefix + 'menu-icon-select',\n        size: 'xs',\n        style: {\n          left: (indentSize || 20) - 16 + 'px'\n        }\n      }) : null) : null;\n      return _react2['default'].createElement('li', {\n        className: cls,\n        'aria-haspopup': true,\n        onKeyDown: this.onKeyDown\n      }, _react2['default'].createElement('div', _extends({\n        className: prefix + 'menu-submenu-title'\n      }, events, {\n        style: {\n          paddingLeft: indentSize\n        }\n      }), label, icon), selectedIcon, child);\n    }\n  };\n\n  SubMenu.prototype.componentDidMount = function componentDidMount() {\n    if (this.props.mode === 'popup') {\n      _nextDom.events.on(document, 'click', this.onDocumentClick);\n    }\n  };\n\n  SubMenu.prototype.componentWillUnmount = function componentWillUnmount() {\n    if (this.props.mode === 'popup') {\n      _nextDom.events.off(document, 'click', this.onDocumentClick);\n    }\n  };\n\n  SubMenu.prototype.onDocumentClick = function onDocumentClick(e) {\n    var node = (0, _reactDom.findDOMNode)(this.root),\n        target = e.target;\n\n    if (!(node && node.contains(target))) {\n      this.onVisibleChange(false, 'fromDoc');\n    }\n  };\n\n  SubMenu.prototype.onSubMenuClick = function onSubMenuClick(index, e) {\n    var visible = !this.normalizeVisible();\n    this.onVisibleChange(visible);\n\n    if (e && e.stopPropagation) {\n      e.stopPropagation();\n    } else {\n      index.stopPropagation();\n    }\n  };\n\n  SubMenu.prototype.onSubMenuMouseEnter = function onSubMenuMouseEnter(e, type) {\n    var _this3 = this;\n\n    this.onContentMouseEnter();\n    this._subMenuEnterTimeout = setTimeout(function () {\n      _this3.onVisibleChange(true, type);\n    }, 150);\n  };\n\n  SubMenu.prototype.onSubMenuMouseLeave = function onSubMenuMouseLeave(e, type) {\n    var _this4 = this;\n\n    this._subMenuEnterTimeout && clearTimeout(this._subMenuEnterTimeout);\n    this._subMenuTimeout = setTimeout(function () {\n      _this4.onVisibleChange(false, type);\n    }, 150);\n  };\n\n  SubMenu.prototype.onContentMouseEnter = function onContentMouseEnter() {\n    this._subMenuTimeout && clearTimeout(this._subMenuTimeout);\n  };\n\n  SubMenu.prototype.onContentMouseLeave = function onContentMouseLeave(e) {\n    this._subMenuEnterTimeout && clearTimeout(this._subMenuEnterTimeout);\n    this.onSubMenuMouseLeave(e, 'fromContent');\n  };\n\n  SubMenu.prototype.onVisibleChange = function onVisibleChange(visible, type) {\n    var _this5 = this;\n\n    if (type === 'fromDoc') {\n      this.root.onOpen(this.props.index, visible);\n    } else {\n      var parentIndexes = this.getParentByType(SubMenu).map(function (parent) {\n        return parent.props.index || parent.key;\n      });\n      var indexes = [this.props.index];\n\n      if (!visible && !this._openByKeyBoard && type === 'fromContent') {\n        indexes = indexes.concat(parentIndexes);\n      }\n\n      indexes.forEach(function (index) {\n        _this5.root.onOpen(index, visible);\n      });\n      this._openByKeyBoard = false;\n    }\n  };\n\n  SubMenu.prototype.onKeyDown = function onKeyDown(e) {\n    if (e.keyCode === _nextUtil.keyCode.ENTER || e.keyCode === _nextUtil.keyCode.SPACE) {\n      this.onSubMenuClick(e);\n    }\n  };\n\n  SubMenu.prototype.getContentNode = function getContentNode() {\n    return _reactDom2['default'].findDOMNode(this.refs.content);\n  };\n\n  return SubMenu;\n}(Component), _class._menuItem = true, _class._subMenu = true, _class.propTypes = {\n  /**\n   * 样式类名的品牌前缀\n   */\n  prefix: _propTypes2['default'].string,\n\n  /**\n   * 自定义类名\n   */\n  className: _propTypes2['default'].string,\n\n  /**\n   * 自定义内联样式\n   */\n  style: _propTypes2['default'].object,\n\n  /**\n   * 子菜单的标签\n   */\n  label: _propTypes2['default'].any,\n  visible: _propTypes2['default'].bool,\n\n  /**\n   * 设置子菜单表现的形式\n   */\n  mode: _propTypes2['default'].oneOf(['inline', 'popup']),\n\n  /**\n   * 设置子菜单显示触发的类型\n   */\n  triggerType: _propTypes2['default'].oneOf(['click', 'hover']),\n\n  /**\n   * 设置子菜单的label是否可以被选中\n   */\n  selectable: _propTypes2['default'].bool,\n\n  /**\n   * 设置子菜单的跟随类型\n   */\n  align: _propTypes2['default'].oneOf(['outside', 'follow']),\n  onClick: _propTypes2['default'].func,\n  hasSelectedIcon: _propTypes2['default'].bool\n}, _class.defaultProps = {\n  label: 'sub-item',\n  animation: {\n    'in': 'slide-down',\n    out: 'slide-up'\n  },\n  mode: 'inline',\n  triggerType: 'click',\n  selectable: false,\n  align: 'follow',\n  prefix: 'next-',\n  onClick: function onClick() {},\n  hasSelectedIcon: true\n}, _class.contextTypes = {\n  parentIndex: _propTypes2['default'].array,\n  parentLabel: _propTypes2['default'].array,\n  prefix: _propTypes2['default'].string\n}, _class.childContextTypes = {\n  parentIndex: _propTypes2['default'].array,\n  parentLabel: _propTypes2['default'].array\n}, _temp);\nSubMenu.displayName = 'SubMenu';\nexports['default'] = SubMenu;\n\nfunction normalizeInfo(context, name, value) {\n  var meta = void 0;\n\n  if (context[name]) {\n    meta = [].concat(_toConsumableArray(context[name]));\n    meta.push(value);\n  } else {\n    meta = [value];\n  }\n\n  return meta;\n}\n\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}