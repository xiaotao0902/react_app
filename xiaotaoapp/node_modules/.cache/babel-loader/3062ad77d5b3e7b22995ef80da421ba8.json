{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _class, _temp;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _nextIcon = require('../../next-icon/lib/index.js');\n\nvar _nextIcon2 = _interopRequireDefault(_nextIcon);\n\nvar _nextInput = require('../../next-input/lib/index.js');\n\nvar _nextInput2 = _interopRequireDefault(_nextInput);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);\n}\n\nfunction noop() {}\n\nfunction preventDefault(e) {\n  e.preventDefault();\n}\n/** NumberPicker */\n\n\nvar NumberPicker = (_temp = _class = function (_React$Component) {\n  _inherits(NumberPicker, _React$Component);\n\n  function NumberPicker(props) {\n    _classCallCheck(this, NumberPicker);\n\n    var _this = _possibleConstructorReturn(this, _React$Component.call(this, props));\n\n    var value = void 0;\n\n    if ('value' in props) {\n      value = props.value;\n    } else {\n      value = props.defaultValue;\n    }\n\n    value = _this.toPrecisionAsStep(value);\n    _this.state = {\n      value: value,\n      focused: props.autoFocus\n    };\n    return _this;\n  }\n\n  NumberPicker.prototype.componentDidMount = function componentDidMount() {\n    this.componentDidUpdate();\n  };\n\n  NumberPicker.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if ('value' in nextProps) {\n      if (nextProps.value === undefined) {\n        this.setState({\n          value: ''\n        });\n        return;\n      }\n\n      var value = this.toPrecisionAsStep(nextProps.value);\n      this.setState({\n        value: value\n      });\n    }\n  };\n\n  NumberPicker.prototype.componentDidUpdate = function componentDidUpdate() {\n    if (this.state.focused && document.activeElement !== this.refs.input.getInputNode()) {\n      this.refs.input.getInputNode().focus();\n    }\n  };\n\n  NumberPicker.prototype.onChange = function onChange(value, e) {\n    if (this.props.editable === true) {\n      value = value.trim(); // ignore space\n\n      if (this.state.value === value) {\n        return;\n      } // in case of autoCorrect ('0.'=>0, '0.0'=>0) , we have these steps\n\n\n      if (value) {\n        // ignore when input start form '-'\n        if (value === '-' || this.state.value === '-') {\n          this.setState({\n            value: value\n          });\n          return;\n        } // ignore when next value = last value.\n        // ps: Number('0.')=0 ; Number('0.0')=0;\n        // but take care of Number('')=0;\n\n\n        if (Number(this.state.value) === Number(value)) {\n          this.setState({\n            value: value\n          });\n          return;\n        } // ignore when value < min (because number is inputted one by one)\n\n\n        if (!isNaN(value) && Number(value) < this.props.min) {\n          this.setState({\n            value: value\n          });\n          return;\n        }\n      }\n\n      this.setInputValue(value, e);\n    }\n  };\n\n  NumberPicker.prototype.onCorrect = function onCorrect(currentValue, oldValue) {\n    this.props.onCorrect({\n      currentValue: currentValue,\n      oldValue: oldValue\n    });\n  };\n\n  NumberPicker.prototype.onKeyDown = function onKeyDown(e) {\n    var _props;\n\n    if (e.keyCode === 38) {\n      this.up(e);\n    } else if (e.keyCode === 40) {\n      this.down(e);\n    }\n\n    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    (_props = this.props).onKeyDown.apply(_props, [e].concat(args));\n  };\n\n  NumberPicker.prototype.onFocus = function onFocus() {\n    var _props2;\n\n    this.setState({\n      focused: true\n    });\n\n    (_props2 = this.props).onFocus.apply(_props2, arguments);\n  };\n\n  NumberPicker.prototype.onBlur = function onBlur(e) {\n    var _props3;\n\n    this.setState({\n      focused: false\n    });\n    var value = this.getCurrentValidValue(e.target.value.trim());\n\n    if (this.state.value !== value) {\n      this.setValue(value, e);\n    }\n\n    for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    (_props3 = this.props).onBlur.apply(_props3, [e].concat(args));\n  };\n\n  NumberPicker.prototype.onStepMouseDown = function onStepMouseDown(e) {\n    e.preventDefault();\n    var value = this.getCurrentValidValue(this.state.value);\n    this.setState({\n      value: value\n    });\n  };\n\n  NumberPicker.prototype.getCurrentValidValue = function getCurrentValidValue(value) {\n    var val = value;\n    var props = this.props;\n\n    if (val === '') {\n      val = '';\n    } else if (!isNaN(val)) {\n      val = Number(val);\n\n      if (val < props.min) {\n        val = props.min;\n      }\n\n      if (val > props.max) {\n        val = props.max;\n      }\n    } else {\n      val = this.state.value;\n    }\n\n    var correctValue = this.toPrecisionAsStep(val);\n\n    if ('' + correctValue !== '' + value) {\n      this.onCorrect(correctValue, value);\n    }\n\n    return correctValue;\n  };\n\n  NumberPicker.prototype.setValue = function setValue(v, e) {\n    if (!('value' in this.props)) {\n      this.setState({\n        value: v\n      });\n    }\n\n    this.props.onChange(isNaN(v) || v === '' ? undefined : v, e);\n  };\n\n  NumberPicker.prototype.setInputValue = function setInputValue(v, e) {\n    var value = this.getCurrentValidValue(v);\n    this.setValue(value, e);\n  };\n\n  NumberPicker.prototype.getPrecision = function getPrecision() {\n    var props = this.props;\n    var stepString = props.step.toString();\n\n    if (stepString.indexOf('e-') >= 0) {\n      return parseInt(stepString.slice(stepString.indexOf('e-')), 10);\n    }\n\n    var precision = 0;\n\n    if (stepString.indexOf('.') >= 0) {\n      precision = stepString.length - stepString.indexOf('.') - 1;\n    }\n\n    return precision;\n  };\n\n  NumberPicker.prototype.getPrecisionFactor = function getPrecisionFactor() {\n    var precision = this.getPrecision();\n    return Math.pow(10, precision);\n  };\n\n  NumberPicker.prototype.toPrecisionAsStep = function toPrecisionAsStep(num) {\n    if (isNaN(num) || num === '') {\n      return num;\n    }\n\n    var precision = this.getPrecision();\n    return Number(Number(num).toFixed(precision));\n  };\n\n  NumberPicker.prototype.upStep = function upStep(val) {\n    var _props4 = this.props,\n        step = _props4.step,\n        min = _props4.min;\n    var precisionFactor = this.getPrecisionFactor();\n    var result = void 0;\n\n    if (typeof val === 'number') {\n      result = (precisionFactor * val + precisionFactor * step) / precisionFactor;\n    } else {\n      result = min === -Infinity ? step : min;\n    }\n\n    return this.toPrecisionAsStep(result);\n  };\n\n  NumberPicker.prototype.downStep = function downStep(val) {\n    var _props5 = this.props,\n        step = _props5.step,\n        min = _props5.min;\n    var precisionFactor = this.getPrecisionFactor();\n    var result = void 0;\n\n    if (typeof val === 'number') {\n      result = (precisionFactor * val - precisionFactor * step) / precisionFactor;\n    } else {\n      result = min === -Infinity ? -step : min;\n    }\n\n    return this.toPrecisionAsStep(result);\n  };\n\n  NumberPicker.prototype.step = function step(type, e) {\n    if (e) {\n      e.preventDefault();\n    }\n\n    var props = this.props;\n\n    if (props.disabled) {\n      return;\n    }\n\n    var value = this.state.value;\n\n    if (isNaN(value)) {\n      return;\n    }\n\n    var val = this[type + 'Step'](value);\n\n    if (val > props.max || val < props.min) {\n      return;\n    }\n\n    var ne = _extends({\n      triggerType: type\n    }, e);\n\n    this.setValue(val, ne);\n    this.setState({\n      focused: true\n    });\n  };\n\n  NumberPicker.prototype.down = function down(e) {\n    this.step('down', e);\n  };\n\n  NumberPicker.prototype.up = function up(e) {\n    this.step('up', e);\n  };\n\n  NumberPicker.prototype.focus = function focus() {\n    this.refs.input.getInputNode().focus();\n  };\n\n  NumberPicker.prototype.render = function render() {\n    var _classNames;\n    /* eslint-disable no-unused-vars */\n\n\n    var _props6 = this.props,\n        type = _props6.type,\n        prefix = _props6.prefix,\n        editable = _props6.editable,\n        inputWidth = _props6.inputWidth,\n        className = _props6.className,\n        props = _objectWithoutProperties(_props6, ['type', 'prefix', 'editable', 'inputWidth', 'className']);\n    /* eslint-enable */\n\n\n    var inputStyle = {\n      width: inputWidth\n    };\n    var prefixCls = (this.context.prefix || prefix) + 'number-picker'; // Remove React warning.\n    // Warning: Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both).\n\n    delete props.defaultValue;\n    var classes = (0, _classnames2['default'])((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-' + this.props.type, this.props.type), _defineProperty(_classNames, prefixCls + '-disabled', props.disabled), _defineProperty(_classNames, className, className), _classNames));\n    var upDisabledClass = '';\n    var downDisabledClass = '';\n    var value = this.state.value;\n\n    if (!isNaN(value)) {\n      var val = Number(value);\n\n      if (val >= props.max) {\n        upDisabledClass = prefixCls + '-handler-up-disabled';\n      }\n\n      if (val <= props.min) {\n        downDisabledClass = prefixCls + '-handler-down-disabled';\n      }\n    } else {\n      upDisabledClass = prefixCls + '-handler-up-disabled';\n      downDisabledClass = prefixCls + '-handler-down-disabled';\n    } // ref for test\n\n\n    return _react2['default'].createElement('div', {\n      className: classes,\n      style: props.style\n    }, _react2['default'].createElement('div', {\n      className: prefixCls + '-handler-wrap'\n    }, _react2['default'].createElement('a', {\n      unselectable: 'unselectable',\n      ref: 'up',\n      onClick: upDisabledClass ? this.props.onDisabled : this.up.bind(this),\n      onMouseDown: this.onStepMouseDown.bind(this),\n      className: prefixCls + '-handler ' + prefixCls + '-handler-up ' + upDisabledClass\n    }, _react2['default'].createElement('span', {\n      unselectable: 'unselectable',\n      className: prefixCls + '-handler-up-inner',\n      onClick: preventDefault\n    }, _react2['default'].createElement(_nextIcon2['default'], {\n      type: 'add'\n    }))), _react2['default'].createElement('a', {\n      unselectable: 'unselectable',\n      ref: 'down',\n      onMouseDown: this.onStepMouseDown.bind(this),\n      onClick: downDisabledClass ? this.props.onDisabled : this.down.bind(this),\n      className: prefixCls + '-handler ' + prefixCls + '-handler-down ' + downDisabledClass\n    }, _react2['default'].createElement('span', {\n      unselectable: 'unselectable',\n      className: prefixCls + '-handler-down-inner',\n      onClick: preventDefault\n    }, _react2['default'].createElement(_nextIcon2['default'], {\n      type: 'minus'\n    })))), _react2['default'].createElement('div', {\n      className: prefixCls + '-input-wrap'\n    }, _react2['default'].createElement(_nextInput2['default'], _extends({}, props, {\n      style: inputStyle,\n      className: prefixCls + '-input',\n      autoComplete: 'off',\n      onFocus: this.onFocus.bind(this),\n      onBlur: this.onBlur.bind(this),\n      onKeyDown: this.onKeyDown.bind(this),\n      autoFocus: props.autoFocus,\n      readOnly: !editable,\n      onChange: this.onChange.bind(this),\n      ref: 'input',\n      value: this.state.value\n    }))));\n  };\n\n  return NumberPicker;\n}(_react2['default'].Component), _class.propTypes = {\n  /**\n   * 样式前缀\n   */\n  prefix: _propTypes2['default'].string,\n\n  /**\n   * 设置类型\n   * @enumdesc 普通, 内联\n   */\n  type: _propTypes2['default'].oneOf(['normal', 'inline']),\n\n  /**\n   * 当前值\n   */\n  value: _propTypes2['default'].number,\n\n  /**\n   * 默认值\n   */\n  defaultValue: _propTypes2['default'].number,\n\n  /**\n   * 步长\n   */\n  step: _propTypes2['default'].oneOfType([_propTypes2['default'].number, _propTypes2['default'].string]),\n\n  /**\n   * 用户是否可以输入\n   */\n  editable: _propTypes2['default'].bool,\n  autoFocus: _propTypes2['default'].bool,\n\n  /**\n   * 输入框的宽度\n   */\n  inputWidth: _propTypes2['default'].oneOfType([_propTypes2['default'].number, _propTypes2['default'].string]),\n\n  /**\n   * 数值被改变的事件\n   * @param {Number} value 数据\n   * @param {Event} e DOM事件对象\n   */\n  onChange: _propTypes2['default'].func,\n\n  /**\n   * 键盘按下\n   */\n  onKeyDown: _propTypes2['default'].func,\n\n  /**\n   * 焦点获得\n   */\n  onFocus: _propTypes2['default'].func,\n\n  /**\n   * 焦点失去\n   */\n  onBlur: _propTypes2['default'].func,\n\n  /**\n   * 按钮被禁用时候点击的回调\n   * @param {Event} e DOM事件对象\n   */\n  onDisabled: _propTypes2['default'].func,\n\n  /**\n   * 数值订正后的回调\n   * @param {Object} obj {currentValue,oldValue:String}\n   */\n  onCorrect: _propTypes2['default'].func,\n\n  /**\n   * 最大值\n   */\n  max: _propTypes2['default'].number,\n\n  /**\n   * 最小值\n   */\n  min: _propTypes2['default'].number,\n\n  /**\n   * 自定义class\n   */\n  className: _propTypes2['default'].string,\n\n  /**\n   * 自定义内联样式\n   */\n  style: _propTypes2['default'].object\n}, _class.defaultProps = {\n  prefix: 'next-',\n  max: Infinity,\n  min: -Infinity,\n  type: 'normal',\n  step: 1,\n  style: {},\n  defaultValue: 0,\n  editable: true,\n  onChange: noop,\n  onKeyDown: noop,\n  onFocus: noop,\n  onBlur: noop,\n  onDisabled: noop,\n  onCorrect: noop\n}, _class.contextTypes = {\n  prefix: _propTypes2['default'].string\n}, _temp);\nNumberPicker.displayName = 'NumberPicker';\nexports['default'] = NumberPicker;\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}