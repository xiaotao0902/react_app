{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports['default'] = undefined;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _class, _temp;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _nextUtil = require('../../next-util/lib/index.js');\n\nvar _overlay = require('./overlay.js');\n\nvar _overlay2 = _interopRequireDefault(_overlay);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);\n}\n\nvar Children = _react2['default'].Children,\n    noop = function noop() {},\n    makeChain = _nextUtil.func.makeChain; // <Popup trigger={}>\n//  <content></content>\n// </Popup>\n// <PopupMenuItem trigger={}>\n//   {menu}\n// </PopupMenuItem>\n\n/** Overlay.Popup */\n\n\nvar Popup = (_temp = _class = function (_React$Component) {\n  _inherits(Popup, _React$Component);\n\n  function Popup(props) {\n    _classCallCheck(this, Popup);\n\n    var _this = _possibleConstructorReturn(this, _React$Component.call(this, props));\n\n    _this.state = {\n      visible: props.visible || props.defaultVisible\n    };\n    ['_onTriggerClick', '_onTriggerFocus', '_onTriggerBlur', '_onContentMouseDown', '_onTriggerMouseEnter', '_onTriggerMouseLeave', '_onContentMouseEnter', '_onContentMouseLeave', '_onTriggerKeyDown'].forEach(function (method) {\n      _this[method] = _this[method].bind(_this);\n    });\n    return _this;\n  }\n\n  Popup.prototype.handleVisibleChange = function handleVisibleChange(visible, type, e) {\n    if (!('visible' in this.props)) {\n      this.setState({\n        visible: visible\n      });\n    }\n\n    this.props.onVisibleChange(visible, type, e);\n  };\n\n  Popup.prototype.render = function render() {\n    return this.getTrigger();\n  };\n\n  Popup.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if ('visible' in nextProps) {\n      this.setState({\n        visible: nextProps.visible\n      });\n    }\n  };\n\n  Popup.prototype.componentWillMount = function componentWillMount() {\n    this.uniqueOverlayKey = getUniqueKey();\n  };\n\n  Popup.prototype.addNodeForSafeClick = function addNodeForSafeClick(node) {\n    if (!this.overlay) {\n      return;\n    }\n\n    this.overlay.addNodeForSafeClick(node);\n  };\n\n  Popup.prototype.getContent = function getContent() {\n    var content = Children.only(this.props.children),\n        props = {};\n\n    switch (this.props.triggerType) {\n      case 'focus':\n        props = {\n          onMouseDown: makeChain(this._onContentMouseDown, content.props.onMouseDown)\n        };\n        break;\n\n      case 'click':\n        props = {};\n        break;\n\n      case 'hover':\n        props = {\n          onMouseEnter: makeChain(this._onContentMouseEnter, content.props.onMouseEnter),\n          onMouseLeave: makeChain(this._onContentMouseLeave, content.props.onMouseLeave)\n        };\n    }\n\n    return _react2['default'].cloneElement(content, props);\n  };\n\n  Popup.prototype.getTriggerNode = function getTriggerNode() {\n    return this.triggerNode || this.refs.trigger;\n  };\n\n  Popup.prototype.getTrigger = function getTrigger() {\n    var _this2 = this;\n\n    var _props = this.props,\n        trigger = _props.trigger,\n        disabled = _props.disabled,\n        props = {};\n\n    if (!disabled) {\n      var originRef = trigger.ref;\n      var ref = typeof originRef === 'function' ? function (node) {\n        originRef(node);\n        _this2.triggerNode = node;\n      } : 'trigger';\n\n      switch (this.props.triggerType) {\n        case 'click':\n          props = {\n            onClick: makeChain(this._onTriggerClick, trigger.props.onClick),\n            onKeyDown: makeChain(this._onTriggerKeyDown, trigger.props.onKeyDown),\n            ref: ref\n          };\n          break;\n\n        case 'focus':\n          props = {\n            onFocus: makeChain(this._onTriggerFocus, trigger.props.onFocus),\n            onBlur: makeChain(this._onTriggerBlur, trigger.props.onBlur),\n            ref: ref\n          };\n          break;\n\n        case 'hover':\n          props = {\n            onMouseEnter: makeChain(this._onTriggerMouseEnter, trigger.props.onMouseEnter),\n            onMouseLeave: makeChain(this._onTriggerMouseLeave, trigger.props.onMouseLeave),\n            onClick: makeChain(this.clearDocumentTimeout, trigger.props.onClick),\n            ref: ref\n          };\n          break;\n\n        default:\n          props = {\n            ref: ref\n          };\n      }\n    }\n\n    return _react2['default'].cloneElement(trigger, props);\n  };\n\n  Popup.prototype.componentDidMount = function componentDidMount() {\n    this._renderOverlay();\n\n    this.addNodeForSafeClick(_reactDom2['default'].findDOMNode(this.getTriggerNode()));\n  };\n\n  Popup.prototype.componentDidUpdate = function componentDidUpdate() {\n    this._renderOverlay();\n\n    this.addNodeForSafeClick(_reactDom2['default'].findDOMNode(this.getTriggerNode()));\n  };\n\n  Popup.prototype.componentWillUnmount = function componentWillUnmount() {\n    var _this3 = this;\n\n    ['_timer', '_hideTimer', '_showTimer'].forEach(function (time) {\n      _this3[time] && clearTimeout(_this3[time]);\n    });\n\n    this._unRenderOverlay();\n  };\n\n  Popup.prototype._renderOverlay = function _renderOverlay() {\n    var _this4 = this;\n\n    if (!this.wrapper) {\n      this.wrapper = document.createElement('div');\n    }\n\n    var _props2 = this.props,\n        autoFocus = _props2.autoFocus,\n        target = _props2.target,\n        others = _objectWithoutProperties(_props2, ['autoFocus', 'target']);\n\n    if (typeof target === 'undefined') {\n      target = function target() {\n        return _this4.getTriggerNode();\n      };\n    }\n\n    var overlay = _react2['default'].createElement(_overlay2['default'], _extends({}, others, {\n      ref: function ref(overlay) {\n        return _this4.overlay = overlay;\n      },\n      visible: this.state.visible,\n      target: target,\n      key: this.uniqueOverlayKey,\n      autoFocus: autoFocus,\n      onRequestClose: function onRequestClose(reason, e) {\n        return _this4.handleVisibleChange(false, reason, e);\n      }\n    }), this.getContent());\n\n    _reactDom2['default'].unstable_renderSubtreeIntoContainer(this, overlay, this.wrapper);\n  };\n\n  Popup.prototype._unRenderOverlay = function _unRenderOverlay() {\n    if (this.wrapper) {\n      _reactDom2['default'].unmountComponentAtNode(this.wrapper);\n\n      this.wrapper = null;\n      this.overlay = null;\n    }\n  };\n\n  Popup.prototype._onTriggerClick = function _onTriggerClick(event, other) {\n    // Hack menu item problem\n    // Will be remove at 2.x\n    var e = event;\n\n    if (other && other.stopPropagation) {\n      e = other;\n    }\n\n    e.stopPropagation();\n    var target = e.target;\n\n    if (target.tagName.toLowerCase() === 'a') {\n      e.preventDefault();\n    }\n\n    this.handleVisibleChange(!this.state.visible, 'fromTrigger', e);\n  };\n\n  Popup.prototype._onTriggerFocus = function _onTriggerFocus(e) {\n    if (this._timer) {\n      clearTimeout(this._timer);\n      this._timer = null;\n    }\n\n    this.handleVisibleChange(true, 'fromTrigger', e);\n    e.stopPropagation();\n  };\n\n  Popup.prototype._onTriggerBlur = function _onTriggerBlur(e) {\n    var _this5 = this;\n\n    if (this._timer) {\n      clearTimeout(this._timer);\n    }\n\n    this._timer = setTimeout(function () {\n      if (!_this5._isForwardContent) {\n        _this5.handleVisibleChange(false, 'fromTrigger', e);\n      }\n\n      _this5._isForwardContent = false;\n    }, this.props.delay);\n  };\n\n  Popup.prototype._onContentMouseDown = function _onContentMouseDown() {\n    this._isForwardContent = true;\n  };\n\n  Popup.prototype._onTriggerMouseEnter = function _onTriggerMouseEnter(e) {\n    var _this6 = this;\n\n    if (this._hideTimer) {\n      clearTimeout(this._hideTimer);\n      this._hideTimer = null;\n    }\n\n    if (this._showTimer) {\n      clearTimeout(this._showTimer);\n      this._showTimer = null;\n    }\n\n    this._showTimer = setTimeout(function () {\n      _this6.handleVisibleChange(true, 'fromTrigger', e);\n    }, this.props.delay);\n  };\n\n  Popup.prototype._onTriggerMouseLeave = function _onTriggerMouseLeave(e, type) {\n    var _this7 = this;\n\n    if (this._showTimer) {\n      clearTimeout(this._showTimer);\n      this._showTimer = null;\n    }\n\n    if (this.state.visible) {\n      this._hideTimer = setTimeout(function () {\n        _this7.handleVisibleChange(false, type || 'fromTrigger', e);\n      }, this.props.delay);\n    }\n  };\n\n  Popup.prototype._onTriggerKeyDown = function _onTriggerKeyDown(e) {\n    // space\n    // enter\n    if (e.keyCode === 32 || e.keyCode === 13) {\n      this._onTriggerClick(e);\n    }\n  };\n\n  Popup.prototype._onContentMouseEnter = function _onContentMouseEnter() {\n    clearTimeout(this._hideTimer);\n  };\n\n  Popup.prototype._onContentMouseLeave = function _onContentMouseLeave(e) {\n    this._onTriggerMouseLeave(e, 'fromContent');\n  };\n\n  return Popup;\n}(_react2['default'].Component), _class.propTypes = {\n  children: _propTypes2['default'].any,\n\n  /**\n   * 弹层相对于target的定位, 详见开发指南的[定位部分](#定位)\n   */\n  align: _propTypes2['default'].string,\n\n  /**\n   * 弹层相对于target定位的微调\n   */\n  offset: _propTypes2['default'].array,\n\n  /**\n   * 触发弹层显示或者隐藏的元素\n   */\n  trigger: _propTypes2['default'].any,\n\n  /**\n   * 触发弹层显示的类型\n   */\n  triggerType: _propTypes2['default'].string,\n\n  /**\n   * 弹层当前显示的状态\n   */\n  visible: _propTypes2['default'].bool,\n\n  /**\n   * 弹层默认显示的状态\n   */\n  defaultVisible: _propTypes2['default'].bool,\n\n  /**\n   * 设置此属性，弹层无法打开\n   */\n  disabled: _propTypes2['default'].bool,\n\n  /**\n   * 弹层在触发以后的延时显示\n   */\n  delay: _propTypes2['default'].number,\n\n  /**\n   * 点击浮层外的区域是否关闭浮层\n   */\n  canCloseByOutSideClick: _propTypes2['default'].bool,\n\n  /**\n   * 弹层在显示和隐藏触发的事件\n   * @param {Boolean} visible 弹层是否隐藏和显示\n   * @param {String} type 触发弹层显示和隐藏的来源\n   * @param {Event} e DOM事件\n   */\n  onVisibleChange: _propTypes2['default'].func,\n\n  /**\n   * 浮层打开的时候是否让里面的元素自动获取焦点\n   */\n  autoFocus: _propTypes2['default'].bool,\n\n  /**\n   * 配置动画的播放方式\n   * @param {String} in 进场动画\n   * @param {String} out 出场动画\n   */\n  animation: _propTypes2['default'].oneOfType([_propTypes2['default'].object, _propTypes2['default'].bool]),\n\n  /**\n   * 配置弹层定位的参照元素\n   */\n  target: _propTypes2['default'].any\n}, _class.defaultProps = {\n  triggerType: 'hover',\n  trigger: _react2['default'].createElement('div', null),\n  align: 'tl bl',\n  offset: [0, 0],\n  disabled: false,\n  delay: 200,\n  canCloseByOutSideClick: true,\n  onVisibleChange: noop,\n  animation: {\n    'in': 'expandInDown',\n    out: 'expandOutUp'\n  }\n}, _temp);\nPopup.displayName = 'Popup';\nexports['default'] = Popup;\nvar uuid = 0;\n\nfunction getUniqueKey() {\n  return 'overlay-' + uuid++;\n}\n\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}