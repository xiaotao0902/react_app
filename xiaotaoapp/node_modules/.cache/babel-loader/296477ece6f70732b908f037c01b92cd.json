{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports['default'] = undefined;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _class, _temp;\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _nextDom = require('../../../next-dom/lib/index.js');\n\nvar _nextBalloon = require('../../../next-balloon/lib/index.js');\n\nvar _nextBalloon2 = _interopRequireDefault(_nextBalloon);\n\nvar _nextUtil = require('../../../next-util/lib/index.js');\n\nvar _utils = require('../utils.js');\n\nvar _scale = require('./scale.js');\n\nvar _scale2 = _interopRequireDefault(_scale);\n\nvar _track = require('./track.js');\n\nvar _track2 = _interopRequireDefault(_track);\n\nvar _selected = require('./selected.js');\n\nvar _selected2 = _interopRequireDefault(_selected);\n\nvar _slider = require('./slider.js');\n\nvar _slider2 = _interopRequireDefault(_slider);\n\nvar _mark2 = require('./mark.js');\n\nvar _mark3 = _interopRequireDefault(_mark2);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    'default': obj\n  };\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);\n}\n\nvar noop = function noop() {};\n\nvar Tooltip = _nextBalloon2['default'].Tooltip;\n/** Range */\n\nvar Range = (_temp = _class = function (_React$Component) {\n  _inherits(Range, _React$Component);\n\n  function Range(props) {\n    _classCallCheck(this, Range);\n\n    var _this = _possibleConstructorReturn(this, _React$Component.call(this, props));\n\n    var min = props.min;\n    var initialValue = _this._isMultiple() ? [min, min] : min;\n    var defaultValue = 'defaultValue' in props ? props.defaultValue : initialValue;\n    var value = props.value !== undefined ? props.value : defaultValue;\n    _this.state = {\n      // tooltipVisible: false,\n      value: value,\n      tempValue: value,\n      hasMovingClass: false\n    };\n    return _this;\n  }\n\n  Range.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    var min = this.props.min;\n    var initialValue = this._isMultiple() ? [min, min] : min;\n\n    if ('value' in nextProps) {\n      var value = nextProps.value;\n\n      if (value === undefined) {\n        // value设置undefined,reset为初始值\n        value = initialValue;\n      }\n\n      this.setState({\n        value: value,\n        tempValue: value\n      });\n    }\n  };\n\n  Range.prototype.render = function render() {\n    var _classNames;\n\n    var value = this._moving ? this.state.tempValue : this.state.value;\n    var _props = this.props,\n        prefix = _props.prefix,\n        min = _props.min,\n        max = _props.max,\n        disabled = _props.disabled,\n        style = _props.style,\n        id = _props.id,\n        slider = _props.slider,\n        reverse = _props.reverse,\n        className = _props.className;\n    prefix = this.context.prefix || prefix;\n    var classes = (0, _classnames2['default'])((_classNames = {}, _defineProperty(_classNames, prefix + 'range', true), _defineProperty(_classNames, 'disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n\n    if (Array.isArray(value)) {\n      value.forEach(function (item, index) {\n        if (item > max) {\n          value[index] = max;\n        }\n      });\n    } else if (value > max) {\n      value = max;\n    }\n\n    var commonProps = {\n      prefix: prefix,\n      min: min,\n      max: max,\n      value: value,\n      reverse: reverse,\n      slider: slider,\n      hasMovingClass: this.state.hasMovingClass\n    }; // slider\n\n    var _renderSlider2 = this._renderSlider(commonProps),\n        lowerSlider = _renderSlider2.lowerSlider,\n        upperSlider = _renderSlider2.upperSlider;\n\n    return _react2['default'].createElement('div', {\n      ref: 'range',\n      className: classes,\n      id: id,\n      onMouseDown: disabled ? noop : this._onMouseDown.bind(this),\n      style: style\n    }, this._renderScale(commonProps), _react2['default'].createElement(_track2['default'], commonProps), _react2['default'].createElement(_selected2['default'], commonProps), lowerSlider, upperSlider, this._renderMark(commonProps));\n  };\n\n  Range.prototype._isMultiple = function _isMultiple() {\n    return this.props.slider === 'double';\n  };\n\n  Range.prototype._renderSlider = function _renderSlider(commonProps) {\n    var lowerSlider = null;\n    var upperSlider = null;\n    var value = commonProps.value;\n    var hasTips = this.props.hasTips;\n    var hasTip = this.props.hasTip;\n\n    if (hasTips !== undefined) {\n      _nextUtil.log.deprecated('hasTips', 'hasTip', 'range');\n\n      hasTip = hasTips;\n    }\n\n    var tipFormatter = this.props.tipFormatter;\n\n    if (this._isMultiple()) {\n      // override value\n      lowerSlider = hasTip ? _react2['default'].createElement(Tooltip, {\n        animation: {\n          'in': 'fadeInUp',\n          out: 'fadeOutDown'\n        },\n        shouldUpdatePosition: true,\n        trigger: _react2['default'].createElement(_slider2['default'], _extends({}, commonProps, {\n          value: value[0]\n        })),\n        align: 't',\n        text: tipFormatter(value[0] + '')\n      }) : _react2['default'].createElement(_slider2['default'], _extends({}, commonProps, {\n        value: value[0]\n      }));\n      upperSlider = hasTip ? _react2['default'].createElement(Tooltip, {\n        animation: {\n          'in': 'fadeInUp',\n          out: 'fadeOutDown'\n        },\n        shouldUpdatePosition: true,\n        trigger: _react2['default'].createElement(_slider2['default'], _extends({}, commonProps, {\n          value: value[1]\n        })),\n        align: 't',\n        text: tipFormatter(value[1] + '')\n      }) : _react2['default'].createElement(_slider2['default'], _extends({}, commonProps, {\n        value: value[1]\n      }));\n    } else {\n      upperSlider = hasTip ? _react2['default'].createElement(Tooltip, {\n        animation: {\n          'in': 'fadeInUp',\n          out: 'fadeOutDown'\n        },\n        shouldUpdatePosition: true,\n        trigger: _react2['default'].createElement(_slider2['default'], commonProps),\n        align: 't',\n        text: tipFormatter(value + '')\n      }) : _react2['default'].createElement(_slider2['default'], commonProps);\n    }\n\n    return {\n      lowerSlider: lowerSlider,\n      upperSlider: upperSlider\n    };\n  };\n\n  Range.prototype._marksToScales = function _marksToScales(marks) {\n    var result = [];\n\n    if (Object.prototype.toString.call(marks) === '[object Object]') {\n      for (var key in marks) {\n        if (Object.hasOwnProperty.call(marks, key)) {\n          result.push(parseInt(key));\n        }\n      }\n    } else {\n      result = marks;\n    }\n\n    return result;\n  };\n\n  Range.prototype._renderScale = function _renderScale(commonProps) {\n    var _props2 = this.props,\n        min = _props2.min,\n        max = _props2.max,\n        marks = _props2.marks;\n\n    var scales = this._marksToScales(marks);\n\n    var scale = null;\n\n    if (scales !== false) {\n      if (Array.isArray(scales)) {\n        scale = _react2['default'].createElement(_scale2['default'], _extends({}, commonProps, {\n          scales: scales\n        }));\n      } else {\n        var pace = (max - min) / scales;\n        var result = [];\n        result.push(min);\n\n        for (var i = 1; i < scales; i++) {\n          result.push(min + i * pace);\n        }\n\n        result.push(max);\n        scale = _react2['default'].createElement(_scale2['default'], _extends({}, commonProps, {\n          scales: result\n        }));\n      }\n    } else {\n      scale = _react2['default'].createElement(_scale2['default'], _extends({}, commonProps, {\n        scales: []\n      }));\n    }\n\n    return scale;\n  };\n\n  Range.prototype._renderMark = function _renderMark(commonProps) {\n    var _props3 = this.props,\n        min = _props3.min,\n        max = _props3.max,\n        marks = _props3.marks;\n    var mark = null;\n\n    if (marks !== false) {\n      var result = {};\n\n      if (Array.isArray(marks)) {\n        marks.forEach(function (m) {\n          result[m] = m.toString();\n        });\n      } else if (typeof marks === 'number') {\n        var pace = (max - min) / marks;\n        result[min] = min;\n\n        for (var i = 1; i < marks; i++) {\n          var _mark = min + i * pace;\n\n          var precision = (0, _utils.getPrecision)(_mark);\n\n          if (precision > 2) {\n            precision = 2;\n          }\n\n          _mark = _mark.toFixed(precision);\n          result[_mark] = _mark;\n        }\n\n        result[max] = max;\n      } else {\n        result = marks;\n      }\n\n      mark = _react2['default'].createElement(_mark3['default'], _extends({}, commonProps, {\n        marks: result\n      }));\n    }\n\n    return mark;\n  };\n\n  Range.prototype._isEqule = function _isEqule(left, right) {\n    if (Array.isArray(left)) {\n      return left[0] === right[0] && left[1] === right[1];\n    } else {\n      return left === right;\n    }\n  };\n\n  Range.prototype._onMouseDown = function _onMouseDown(e) {\n    this.setState({\n      hasMovingClass: true\n    });\n\n    this._start(e.pageX);\n\n    this._addDocumentEvents();\n\n    pauseEvent(e);\n  };\n\n  Range.prototype._start = function _start(position) {\n    var tempValue = this.state.tempValue;\n    var range = this.refs.range;\n    var start = range.getBoundingClientRect().left; // Stabilize\n    // position = start + length *\n\n    this._moving = {\n      start: start,\n      end: start + range.clientWidth,\n      startValue: tempValue\n    }; // change on start\n\n    this._onProcess(position, true);\n  };\n\n  Range.prototype._end = function _end() {\n    var startValue = this._moving.startValue;\n    var _state = this.state,\n        tempValue = _state.tempValue,\n        value = _state.value;\n    this._moving = null;\n\n    this._removeDocumentEvents();\n\n    this.setState({\n      hasMovingClass: false\n    });\n\n    if (!this._isEqule(tempValue, startValue)) {\n      // Not Controlled\n      if (!('value' in this.props)) {\n        this.setState({\n          value: tempValue\n        });\n      } else {\n        this.setState({\n          // tooltipVisible: false,\n          tempValue: value,\n          value: value\n        });\n      }\n\n      this.props.onChange(tempValue);\n    }\n  };\n\n  Range.prototype._move = function _move(e) {\n    this._onProcess(e.pageX);\n  };\n\n  Range.prototype._onProcess = function _onProcess(position, start) {\n    var tempValue = this.state.tempValue;\n\n    var current = this._positionToCurrent(position); //current 为当前click的value\n\n\n    if (start) {\n      this._moving.dragging = this._getDragging(current, tempValue);\n    } // this.setState({\n    //     tooltipVisible: true\n    // })\n\n\n    var nextValue = this._currentToValue(current, tempValue); //计算range的新value,可能是数组,可能是单个值\n\n\n    if (!this._isEqule(nextValue, tempValue)) {\n      this.setState({\n        tempValue: nextValue\n      });\n      this.props.onProcess(nextValue);\n    }\n  };\n\n  Range.prototype._addDocumentEvents = function _addDocumentEvents() {\n    this._onMouseMoveListener = _nextDom.events.on(document, 'mousemove', this._move.bind(this));\n    this._onMouseUpListener = _nextDom.events.on(document, 'mouseup', this._end.bind(this));\n  };\n\n  Range.prototype._removeDocumentEvents = function _removeDocumentEvents() {\n    if (this._onMouseMoveListener) {\n      this._onMouseMoveListener.off();\n\n      this._onMouseMoveListener = null;\n    }\n\n    if (this._onMouseUpListener) {\n      this._onMouseUpListener.off();\n\n      this._onMouseUpListener = null;\n    }\n  };\n\n  Range.prototype._getDragging = function _getDragging(current, preValue) {\n    var dragging = 'upper';\n\n    if (this._isMultiple()) {\n      if (current > preValue[1]) {\n        dragging = 'upper';\n      } else if (current < preValue[0]) {\n        dragging = 'lower';\n      } else {\n        var mid = (preValue[0] + preValue[1]) / 2;\n        dragging = current < mid ? 'lower' : 'upper';\n      }\n    }\n\n    return dragging;\n  }; // position => current (value type)\n\n\n  Range.prototype._positionToCurrent = function _positionToCurrent(position) {\n    var _moving = this._moving,\n        start = _moving.start,\n        end = _moving.end;\n    var _props4 = this.props,\n        step = _props4.step,\n        min = _props4.min,\n        max = _props4.max;\n\n    if (position < start) {\n      position = start;\n    } else if (position > end) {\n      position = end;\n    }\n\n    var pecent = (0, _utils.getPercent)(start, end, position); // reset by step\n\n    var newValue = parseFloat((Math.round(pecent / 100 * (max - min) / step) * step).toFixed((0, _utils.getPrecision)(step)));\n    return min + newValue;\n  };\n\n  Range.prototype._currentToValue = function _currentToValue(current, preValue) {\n    var dragging = this._moving.dragging;\n\n    if (!this._isMultiple()) {\n      return current;\n    } else {\n      var result = void 0;\n\n      if (dragging === 'lower') {\n        if (current > preValue[1]) {\n          result = [preValue[1], current];\n          this._moving.dragging = 'upper';\n        } else {\n          result = [current, preValue[1]];\n        }\n      } else if (dragging === 'upper') {\n        if (current < preValue[0]) {\n          result = [current, preValue[0]];\n          this._moving.dragging = 'lower';\n        } else {\n          result = [preValue[0], current];\n        }\n      }\n\n      return result;\n    }\n  };\n\n  return Range;\n}(_react2['default'].Component), _class.contextTypes = {\n  prefix: _propTypes2['default'].string\n}, _class.propTypes = {\n  /**\n   * 样式类名的品牌前缀\n   */\n  prefix: _propTypes2['default'].string,\n\n  /**\n   * 自定义类名\n   */\n  className: _propTypes2['default'].string,\n\n  /**\n   * 自定义内敛样式\n   */\n  style: _propTypes2['default'].object,\n\n  /**\n   * 滑块个数\n   * @enumdesc 单个, 两个\n   */\n  slider: _propTypes2['default'].oneOf(['single', 'double']),\n\n  /**\n   * 最小值\n   */\n  min: _propTypes2['default'].number,\n\n  /**\n   * 最大值\n   */\n  max: _propTypes2['default'].number,\n\n  /**\n   * 步长，取值必须大于 0，并且可被 (max - min) 整除。\n   */\n  step: _propTypes2['default'].number,\n\n  /**\n   * 设置当前取值。当 `slider` 为 `single` 时，使用 `Number`，否则用 `[Number, Number]`\n   */\n  value: _propTypes2['default'].oneOfType([_propTypes2['default'].number, _propTypes2['default'].arrayOf(_propTypes2['default'].number)]),\n  tempValue: _propTypes2['default'].oneOfType([_propTypes2['default'].number, _propTypes2['default'].arrayOf(_propTypes2['default'].number)]),\n\n  /**\n   * 设置初始取值。当 `slider` 为 `single` 时，使用 `Number`，否则用 `[Number, Number]`\n   */\n  defaultValue: _propTypes2['default'].oneOfType([_propTypes2['default'].number, _propTypes2['default'].arrayOf(_propTypes2['default'].number)]),\n\n  /**\n   * 刻度数值显示逻辑（false 代表不显示，array 枚举显示的值，number 代表按 number 平分，object 表示按 key 划分，value 值显示）\n   */\n  marks: _propTypes2['default'].oneOfType([_propTypes2['default'].bool, _propTypes2['default'].number, _propTypes2['default'].arrayOf(_propTypes2['default'].number), _propTypes2['default'].object]),\n\n  /**\n   * 值为 `true` 时，滑块为禁用状态\n   */\n  disabled: _propTypes2['default'].bool,\n\n  /**\n   * 当 Range 的值发生改变后，会触发 onChange 事件，并把改变后的值作为参数传入, 如果设置了value, 要配合此函数做受控使用\n   * @param {String/number} value\n   */\n  onChange: _propTypes2['default'].func,\n\n  /**\n   * 滑块拖动的时候触发的事件,不建议在这里setState, 一般情况下不需要用, 滑动时有特殊需求时使用\n   * @param {String/number} value\n   */\n  onProcess: _propTypes2['default'].func,\n  hasTips: _propTypes2['default'].bool,\n\n  /**\n   * 是否显示tip\n   */\n  hasTip: _propTypes2['default'].bool,\n\n  /**\n   * tip文件自定义处理\n   */\n  tipFormatter: _propTypes2['default'].func,\n  id: _propTypes2['default'].string,\n\n  /**\n   * 选中态反转\n   */\n  reverse: _propTypes2['default'].bool\n}, _class.defaultProps = {\n  prefix: 'next-',\n  slider: 'single',\n  min: 0,\n  max: 100,\n  step: 1,\n  marks: false,\n  disabled: false,\n  hasTip: true,\n  onChange: noop,\n  onProcess: noop,\n  tipFormatter: function tipFormatter(value) {\n    return value;\n  },\n  reverse: false\n}, _temp);\nRange.displayName = 'Range';\nexports['default'] = Range;\n\nfunction pauseEvent(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\n\nmodule.exports = exports['default'];","map":null,"metadata":{},"sourceType":"script"}